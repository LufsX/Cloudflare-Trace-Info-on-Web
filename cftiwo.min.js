async function fetchCloudflareTraceData(){try{const t=await fetch("/cdn-cgi/trace");if(!t.ok)throw new Error("Failed to fetch Cloudflare trace data");const e=await t.text();return Object.fromEntries(e.trim().split("\n").map((t=>t.split("="))))}catch(t){console.error("Unexpected FFCTD error: ",t)}}async function fetchIATAData(t,e){try{const a=await fetch(`https://iata.isteed.cc/${e}/${t}`);if(!a.ok)throw new Error("Failed to fetch IATA data");return a.text()}catch(t){console.error("Unexpected FID error: ",t)}}async function display(){const t=document.querySelectorAll(".cloudflare-trace-info");if(!t.length)return;const e=navigator.language.includes("zh")?"zh":"en";try{const a=await fetchCloudflareTraceData(),r=Array.from(t).map((async t=>{const r=t.hasAttribute("data-hide-ip"),c=t.hasAttribute("data-hide-loc");let o=t.getAttribute("data-template");if(o?Object.entries(a).forEach((([t,e])=>{o=o.replace(new RegExp(`\\$\\{${t}\\}`,"g"),e||"")})):o=`[${a.colo}]\${iata}${r?"":` · ${a.ip}`}${c?"":` · ${a.loc}`}`,o.includes("${iata}")){const t=await fetchIATAData(a.colo,e);o=o.replace("${iata}",t||"")}t.innerHTML=o.trim()}));await Promise.all(r)}catch(t){console.error("Unexpected DISPLAY error: ",t)}}document.addEventListener("DOMContentLoaded",display);